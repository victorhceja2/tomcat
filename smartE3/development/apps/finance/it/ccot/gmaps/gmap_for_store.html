<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
        <title>CCOT GM</title>
        <link href="http://code.google.com/apis/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" href="/smartE3/resources/css/showcase.css">
        <link rel="stylesheet" href="/smartE3/resources/css/generals.css">

        <script type="text/javascript" src="//maps.googleapis.com/maps/api/js?sensor=false"></script>
        <script type="text/javascript" src="/smartE3/resources/js/gmaps/markerwithlabel.js"></script>
        <script type="text/javascript" src="/smartE3/resources/js/flot/jquery.min.js"></script>

         <style type="text/css">
           .labels {
             color: red;
             background-color: yellow;
             font-family: arial;
             text-align: center;
             width: 40px;
             height: 19px;
             white-space: nowrap;
             top:-32px;
             left:-20px;
             z-index: 10000;
           }
         </style>

        <script type="text/javascript">
            var goMap;
            var goInfowindow;
            var goInitLoacation;

            var gaMapData = new Array(new Array("441","441-Lomas&nbsp;Verdes","ph_logo.gif","19.495722346821346","-99.24829959869385","-99.23448299999998,19.48422399999998,0 -99.234807,19.48484099999999,0 -99.23561700000001,19.48639299999998,0 -99.23573599999997,19.48662300000003,0 -99.23583300000001,19.48685800000001,0 -99.235979,19.48720499999998,0 -99.23613299999997,19.48735700000001,0 -99.23633,19.48785799999997,0 -99.236411,19.48807799999999,0 -99.236546,19.48848599999998,0 -99.23675199999998,19.48858999999999,0 -99.236955,19.48918200000001,0 -99.23711400000001,19.48978799999999,0 -99.23714500000001,19.49003700000001,0 -99.237183,19.49038699999999,0 -99.23719799999999,19.49047999999997,0 -99.23718900000002,19.49072799999999,0 -99.23716899999998,19.49132100000001,0 -99.23714800000002,19.49213399999998,0 -99.23708199999999,19.49381,0 -99.23707600000002,19.494738,0 -99.237027,19.49707700000001,0 -99.237083,19.49756600000002,0 -99.23727999999998,19.498856,0 -99.23730000000001,19.49907899999999,0 -99.23731700000002,19.49932900000001,0 -99.23767899999999,19.49939299999999,0 -99.23782599999998,19.49940699999999,0 -99.23792899999999,19.49940699999999,0 -99.238096,19.49939299999999,0 -99.240008,19.49911800000002,0 -99.24294399999998,19.49871600000001,0 -99.24312000000002,19.49868900000001,0 -99.24480799999999,19.498429,0 -99.24683799999997,19.49813699999998,0 -99.24752000000001,19.49803200000001,0 -99.24813500000002,19.497958,0 -99.24814399999998,19.49807600000001,0 -99.24838800000001,19.49812100000002,0 -99.248583,19.498184,0 -99.24869799999999,19.49826500000002,0 -99.24878800000001,19.49836000000001,0 -99.24889400000001,19.49856299999998,0 -99.24898399999999,19.49872599999999,0 -99.249056,19.49891099999999,0 -99.249014,19.49930499999998,0 -99.24902400000001,19.49940899999999,0 -99.24899599999999,19.49991900000002,0 -99.248926,19.50095500000001,0 -99.24888800000001,19.50110000000002,0 -99.248898,19.501195,0 -99.24894999999998,19.50128899999999,0 -99.249093,19.50133399999999,0 -99.24924600000001,19.50135699999998,0 -99.24936,19.50136099999999,0 -99.24965099999999,19.501392,0 -99.25032899999999,19.501821,0 -99.25037200000001,19.50196599999997,0 -99.25045700000001,19.50180299999999,0 -99.25053799999999,19.50172599999998,0 -99.25060000000001,19.501694,0 -99.25067199999999,19.50169800000002,0 -99.250767,19.50172500000001,0 -99.25086699999999,19.50179800000002,0 -99.251245,19.502263,0 -99.25134799999999,19.50219500000001,0 -99.25128599999999,19.50210199999999,0 -99.251364,19.50212899999999,0 -99.25143900000001,19.50210100000003,0 -99.251479,19.502047,0 -99.251486,19.50194099999998,0 -99.25165,19.50189500000001,0 -99.25172600000001,19.50199500000001,0 -99.25212300000001,19.502434,0 -99.25239700000002,19.502689,0 -99.25441600000001,19.50403599999998,0 -99.25539399999998,19.50461700000001,0 -99.25637500000002,19.50524400000001,0 -99.25734000000001,19.50584599999998,0 -99.25777100000002,19.50615600000001,0 -99.25801800000001,19.50629899999997,0 -99.26049999999999,19.50777599999999,0 -99.260955,19.50802400000001,0 -99.26116100000002,19.50812999999999,0 -99.261264,19.50818300000002,0 -99.26135599999999,19.50828200000002,0 -99.261849,19.50829600000002,0 -99.264449,19.50822600000002,0 -99.265295,19.50818799999999,0 -99.266267,19.50815599999998,0 -99.26667999999998,19.50814299999998,0 -99.26671,19.50800399999999,0 -99.26671099999999,19.50799699999998,0 -99.266857,19.50795299999997,0 -99.26757899999998,19.50746299999999,0 -99.26782499999999,19.507309,0 -99.26836400000001,19.507294,0 -99.26860200000002,19.50728599999998,0 -99.26870200000002,19.50722800000002,0 -99.26924800000001,19.50684699999999,0 -99.27027,19.50609399999999,0 -99.27082299999999,19.50570000000001,0 -99.27103099999999,19.50556100000002,0 -99.27122999999999,19.50540000000001,0 -99.27139200000001,19.505341,0 -99.27172200000001,19.50528199999999,0 -99.271692,19.50517999999999,0 -99.27165299999997,19.50510000000001,0 -99.271607,19.50506400000002,0 -99.27153,19.50502000000002,0 -99.27216200000001,19.504785,0 -99.27207700000001,19.50445099999998,0 -99.27205399999998,19.50440800000002,0 -99.27199999999999,19.50413999999999,0 -99.27198499999999,19.50399400000002,0 -99.271946,19.50361000000002,0 -99.27190400000001,19.503531,0 -99.27179199999999,19.50332000000001,0 -99.27160799999999,19.50284900000001,0 -99.271554,19.50259499999998,0 -99.27151499999999,19.50235599999999,0 -99.271469,19.50229799999998,0 -99.27140799999999,19.50226899999998,0 -99.27127799999998,19.502262,0 -99.27115600000001,19.502262,0 -99.270918,19.502204,0 -99.27074199999998,19.50207399999999,0 -99.27047499999999,19.502205,0 -99.270116,19.50238699999999,0 -99.269468,19.502577,0 -99.26863299999998,19.50276600000002,0 -99.26806699999999,19.50285399999998,0 -99.267797,19.50179600000001,0 -99.26821800000002,19.50170099999998,0 -99.26862699999998,19.50166800000001,0 -99.269052,19.50168999999999,0 -99.269266,19.50163900000001,0 -99.26948300000001,19.50151799999999,0 -99.26969700000001,19.50131799999999,0 -99.270031,19.50098999999999,0 -99.27014399999999,19.50090399999999,0 -99.27027800000001,19.50086299999999,0 -99.27041199999998,19.50086900000001,0 -99.27064000000001,19.50090399999999,0 -99.271075,19.50088999999999,0 -99.27127199999998,19.50085500000001,0 -99.27140900000001,19.50080399999999,0 -99.271509,19.50071200000001,0 -99.27162300000002,19.50054700000003,0 -99.27175599999998,19.500267,0 -99.27184,19.50014999999999,0 -99.27205399999998,19.50001300000001,0 -99.26992699999997,19.49781200000003,0 -99.270301,19.497416,0 -99.27055,19.49708000000002,0 -99.27093000000001,19.49633599999997,0 -99.27150399999999,19.49491399999998,0 -99.27154499999999,19.49468999999999,0 -99.271489,19.49451199999997,0 -99.271579,19.49399199999999,0 -99.271474,19.49380199999997,0 -99.27133500000001,19.49366399999999,0 -99.27119600000002,19.49354600000002,0 -99.27105799999998,19.49350000000001,0 -99.270898,19.49346000000002,0 -99.27059300000001,19.493468,0 -99.27035000000001,19.493455,0 -99.269823,19.493482,0 -99.26942699999999,19.49342299999999,0 -99.269122,19.49343699999999,0 -99.26867699999998,19.49335200000003,0 -99.26807999999998,19.49312199999999,0 -99.26780300000002,19.49297799999998,0 -99.267747,19.49290600000002,0 -99.26645399999998,19.49151299999999,0 -99.266364,19.49139399999998,0 -99.26626400000001,19.48979600000001,0 -99.26646599999998,19.490032,0 -99.26652799999999,19.48995999999999,0 -99.26687500000001,19.48993899999998,0 -99.26727,19.48979400000001,0 -99.267596,19.489636,0 -99.26785299999999,19.48958899999999,0 -99.26816499999998,19.48954599999999,0 -99.26828999999998,19.48952900000002,0 -99.26820499999998,19.489023,0 -99.26809400000001,19.48880599999999,0 -99.26798399999998,19.48860200000002,0 -99.26778800000001,19.48858600000002,0 -99.26770200000001,19.488579,0 -99.26770899999998,19.48802900000001,0 -99.26974299999998,19.48814400000002,0 -99.26992799999999,19.48810700000003,0 -99.27088000000001,19.48839900000001,0 -99.27201,19.48871999999999,0 -99.272257,19.48858699999998,0 -99.27259599999998,19.488696,0 -99.272868,19.48878400000001,0 -99.27299999999998,19.48879900000001,0 -99.27323199999999,19.48878400000001,0 -99.273456,19.48879099999999,0 -99.27360200000001,19.48830599999999,0 -99.273625,19.48826199999999,0 -99.27375600000001,19.48775600000001,0 -99.27379500000001,19.48771899999998,0 -99.27466699999999,19.486926,0 -99.27475199999999,19.48683000000001,0 -99.27487600000001,19.48667599999997,0 -99.27452700000001,19.48639100000002,0 -99.274434,19.48629499999999,0 -99.27394999999999,19.48570599999997,0 -99.273706,19.485402,0 -99.27351999999998,19.48515299999998,0 -99.272176,19.48556200000001,0 -99.272066,19.48559499999998,0 -99.27126,19.48542799999999,0 -99.27114499999999,19.48531900000001,0 -99.27077900000001,19.48529500000002,0 -99.27043999999999,19.48525299999998,0 -99.270324,19.48519300000001,0 -99.269792,19.48496900000002,0 -99.27009899999997,19.48426300000001,0 -99.26973299999999,19.48395400000002,0 -99.2692,19.48345699999998,0 -99.26848199999999,19.48286199999999,0 -99.26827,19.48266800000001,0 -99.268024,19.48251299999997,0 -99.267613,19.481868,0 -99.269795,19.48217299999998,0 -99.27354600000001,19.48262900000002,0 -99.274597,19.48207000000001,0 -99.27527000000001,19.48194400000002,0 -99.27635899999999,19.48127500000002,0 -99.27691599999999,19.48116400000003,0 -99.27816,19.48078099999999,0 -99.278786,19.48029599999999,0 -99.280694,19.47886999999999,0 -99.27918800000001,19.47409599999999,0 -99.279073,19.47274199999999,0 -99.277541,19.47116600000001,0 -99.277084,19.47132899999998,0 -99.27565,19.47167900000001,0 -99.274637,19.47185500000002,0 -99.27364600000001,19.47200299999999,0 -99.27280400000001,19.47206900000002,0 -99.27146500000001,19.47219999999999,0 -99.27098700000001,19.47217799999997,0 -99.27065200000001,19.47207099999999,0 -99.270169,19.47200299999999,0 -99.26947599999998,19.47205000000001,0 -99.268925,19.47209300000001,0 -99.26844200000001,19.47212999999999,0 -99.26803700000001,19.47219699999998,0 -99.26773400000002,19.47221300000003,0 -99.26747899999998,19.47216800000002,0 -99.2672,19.47202500000002,0 -99.26699200000002,19.47186600000001,0 -99.266745,19.47169300000001,0 -99.26658499999999,19.47161699999999,0 -99.266386,19.47155,0 -99.266138,19.47148899999999,0 -99.26587499999999,19.47145999999999,0 -99.265612,19.47135399999997,0 -99.265373,19.47119600000001,0 -99.26521200000001,19.47107099999998,0 -99.26505799999998,19.47105199999997,0 -99.26464799999999,19.47098399999998,0 -99.264546,19.47090299999999,0 -99.26429899999998,19.47074499999999,0 -99.26397000000002,19.47059999999998,0 -99.263706,19.47048899999999,0 -99.26348300000001,19.47036199999999,0 -99.26325600000001,19.47031599999998,0 -99.262582,19.47021300000001,0 -99.26213199999999,19.47015999999998,0 -99.26151899999999,19.47011800000002,0 -99.26125899999998,19.47009600000001,0 -99.260606,19.47017799999999,0 -99.25946999999998,19.46993299999999,0 -99.25888999999998,19.46982199999999,0 -99.25876,19.46981800000003,0 -99.25862999999998,19.46985699999997,0 -99.258549,19.46991899999999,0 -99.25848499999998,19.46996900000001,0 -99.25842,19.47003399999999,0 -99.258391,19.46990399999999,0 -99.25834599999999,19.46980799999999,0 -99.25827699999999,19.46974200000001,0 -99.25818799999999,19.46970400000002,0 -99.25811100000001,19.46968500000001,0 -99.257961,19.46971999999999,0 -99.25781499999998,19.46983099999998,0 -99.25765300000001,19.46991600000002,0 -99.25753499999999,19.47001999999999,0 -99.257471,19.47014699999999,0 -99.257446,19.47024000000001,0 -99.25742600000001,19.47032800000002,0 -99.25741399999997,19.470451,0 -99.257621,19.47054700000003,0 -99.25736199999999,19.47084000000001,0 -99.25723299999999,19.47097499999999,0 -99.25715200000001,19.471164,0 -99.257132,19.47125200000001,0 -99.25711999999999,19.471375,0 -99.257096,19.47149500000001,0 -99.25699899999999,19.471733,0 -99.256889,19.47195699999999,0 -99.25668300000001,19.47223800000002,0 -99.25654900000001,19.472446,0 -99.25630700000001,19.47278099999998,0 -99.25614099999999,19.47302699999999,0 -99.25601599999999,19.47326400000002,0 -99.255945,19.47343899999999,0 -99.25586199999998,19.47396999999999,0 -99.25584499999999,19.47406899999999,0 -99.25584399999997,19.47425800000001,0 -99.25580000000001,19.474783,0 -99.255792,19.47490999999999,0 -99.25578400000001,19.47503699999999,0 -99.255769,19.47515600000001,0 -99.25575499999999,19.47527100000001,0 -99.255741,19.47540200000002,0 -99.25573100000001,19.47548900000002,0 -99.255556,19.47631799999999,0 -99.255565,19.47639799999997,0 -99.25563200000002,19.47645700000002,0 -99.255483,19.47652500000001,0 -99.25545099999998,19.47643199999999,0 -99.255398,19.476364,0 -99.255326,19.47629600000001,0 -99.25523399999997,19.47627699999999,0 -99.25507300000001,19.476267,0 -99.254983,19.47630100000002,0 -99.254907,19.476364,0 -99.25452799999999,19.47653900000001,0 -99.25437099999999,19.47662600000001,0 -99.25412300000002,19.47673199999999,0 -99.253704,19.47687499999999,0 -99.25369000000001,19.47703299999999,0 -99.253179,19.47712300000001,0 -99.252641,19.47740299999999,0 -99.25236600000001,19.47756799999997,0 -99.25211000000002,19.47779900000002,0 -99.25175900000001,19.478462,0 -99.25143900000001,19.47902799999999,0 -99.25117599999999,19.47926100000001,0 -99.250879,19.47943400000001,0 -99.25032399999999,19.47973400000002,0 -99.24959399999999,19.47988100000003,0 -99.24924,19.47993200000001,0 -99.248952,19.48003399999998,0 -99.248383,19.48022499999999,0 -99.24804799999997,19.48036500000002,0 -99.24766499999997,19.48053799999999,0 -99.24759,19.48057700000002,0 -99.24735399999999,19.480684,0 -99.24552399999999,19.48151799999998,0 -99.24458799999998,19.48192900000002,0 -99.24291900000002,19.48211,0 -99.240484,19.48246199999999,0 -99.24033299999999,19.482495,0 -99.24004399999998,19.482538,0 -99.23991599999998,19.482552,0 -99.23981499999998,19.482595,0 -99.239721,19.48274000000001,0 -99.23968699999999,19.48289900000002,0 -99.239627,19.48308399999998,0 -99.23934199999999,19.48364399999999,0 -99.23917000000002,19.48386600000001,0 -99.23895199999998,19.48405500000002,0 -99.23878999999998,19.48418399999998,0 -99.23872299999999,19.484205,0 -99.238366,19.48432,0 -99.238069,19.48437299999999,0 -99.23772299999999,19.48441299999999,0 -99.23719300000001,19.48445699999999,0 -99.236599,19.484504,0 -99.23624900000002,19.48451499999999,0 -99.23598099999998,19.48452699999999,0 -99.23565499999998,19.48456400000001,0 -99.235496,19.484519,0 -99.23448299999998,19.48422399999998,0","red"));
            var goUpdateAllDataInterval = null;
            var gaTicketMarkers = new Array();
            var gbReentryFlag = true;

            function initPage() {
                goInitLocation = new google.maps.LatLng(19.495722346821346,-99.24829959869385);
                goMap = new google.maps.Map(document.getElementById("divMapCanvas"), {zoom: 14, center: goInitLocation, mapTypeId: google.maps.MapTypeId.ROADMAP});

                goInfoWindow = new google.maps.InfoWindow({content: ""});

                var laPolygons = new Array();
                for (var li = 0; li < gaMapData.length; li++) {
                    laPolygons[li] = new google.maps.Polygon({
                        path: getPolyCordsFromString(gaMapData[li][5]," "),
                        strokeColor: gaMapData[li][6],
                        strokeOpacity: 1.0,
                        strokeWeight: 2
                    });

                    laPolygons[li].setMap(goMap);
                    if (!(gaMapData[li][3]*1==0 && gaMapData[li][4]*1==0)) {
                        createBrandMarker(gaMapData[li][2], "<b>" + gaMapData[li][1] + "</b>", new google.maps.LatLng(gaMapData[li][3]*1, gaMapData[li][4]*1));
                    }
                }

                centerMap();

                goUpdateAllDataInterval = setInterval('updateAllData();',10000);
            }

            function centerMap() {
                goMap.panTo(goInitLocation);
            }

            function createAllTicketMarkers(psData) {
                var laAllData = psData.split('_||_');

                for (var li = 0; li < laAllData.length; li++) {
                    createTicketMarker(laAllData[li].split("_|||_"));
                }
            }

            function createTicketMarker(paData) {
                var loMarker = new MarkerWithLabel({
                   position: new google.maps.LatLng(paData[1]*1,paData[2]*1),
                   draggable: false,
                   map: goMap,
                   labelText: "<blink><font size = '3pt'><b>" + paData[0] + "</b></font></blink>",
                   labelAnchor: new google.maps.Point(22, 0),
                   labelClass: "labels", 
                   labelStyle: {opacity: .75},
                   labelVisible: true,
                   icon: "ticket_pointer.png"
                 });

                gaTicketMarkers[gaTicketMarkers.length] = loMarker;
            }

            function clearAllTicketMarkers() {
                for (var li = 0; li < gaTicketMarkers.length; li++) {
                    gaTicketMarkers[li].setMap(null);
                }

                gaTicketMarkers = new Array();
            }

            function getPolyCordsFromString(psCords, psSeparator) {
                var lsCordinates = psCords;
                var laCordinates = lsCordinates.split(psSeparator);
                var laPolyCords = new Array(laCordinates.length);

                for (var li=0; li < laCordinates.length; li++) {
                    var ldLat = laCordinates[li].split(",")[1]*1.00;
                    var ldLng = laCordinates[li].split(",")[0]*1.00;
                    laPolyCords[li] = new google.maps.LatLng(ldLat, ldLng);
                }

                return laPolyCords;
            }

            function createBrandMarker(psImage, psContent, poLatLng) {
                var loImage = new google.maps.MarkerImage(psImage,new google.maps.Size(37, 45), new google.maps.Point(0,0), new google.maps.Point(18, 45));
                var loMarker = new google.maps.Marker({position: poLatLng, map: goMap, icon: loImage});

                google.maps.event.addListener(loMarker, "click", function() {
                    if (goInfoWindow) goInfoWindow.close();
                    goInfoWindow.setContent(psContent);
                    goInfoWindow.open(goMap, loMarker);
                });

                return loMarker;
            }

            function  updateAllData(){
                if (!gbReentryFlag) return;

                gbReentryFlag = false;

                $.post("/smartE3/DataService",{psService: "getQueryData", psQuery: "SELECT * FROM it_ccs_fn_get_store_gc_ticket_data(441)", psConnectionPool: "jdbc/CallCenter"},
                function(psData) {
                    clearAllTicketMarkers();
                    createAllTicketMarkers(psData);
                    gbReentryFlag = true;
                },"text");
            }

        </script>
    </head>

    <body onload="initPage();">
        <!--
            <a href ="javascript:updateAllData()">Test</a>
        -->
        <table width = "100%" border = "1" cellspacing = "0">
            <tr>
                <td width = "100%">
                    <center>
                        <div id="divMapCanvas" style="height:860px;width:98%;border:2px solid black;"></div>
                    </center>
                </td>
            </tr>
        </table>
    </body>
</html>

